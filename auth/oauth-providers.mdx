---
title: OAuth Providers
description: Configure Google and GitHub OAuth for social login
---

# OAuth Providers

InsForge supports OAuth authentication with Google and GitHub. Users can sign in with their existing accounts.

## Setup OAuth

### 1. Configure Provider Credentials

Set environment variables in your `.env` file:

```bash
# Google OAuth
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# GitHub OAuth  
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret

# OAuth Redirect URIs
GOOGLE_REDIRECT_URI=http://localhost:7130/api/auth/oauth/google/callback
GITHUB_REDIRECT_URI=http://localhost:7130/api/auth/oauth/github/callback
```

### 2. Check OAuth Status

```bash
curl http://localhost:7130/api/config/oauth/status
```

Response:
```json
{
  "google": {
    "enabled": true,
    "clientId": "your-client-id.apps.googleusercontent.com"
  },
  "github": {
    "enabled": true,
    "clientId": "your-github-client-id"
  }
}
```

## Google OAuth

### Get Client ID

1. Go to [Google Cloud Console](https://console.cloud.google.com)
2. Create new project or select existing
3. Enable Google+ API
4. Create OAuth 2.0 credentials
5. Add authorized redirect URI: `http://localhost:7130/api/auth/oauth/google/callback`

### Frontend Integration

```javascript
// Get Google OAuth URL and redirect
async function loginWithGoogle() {
  const response = await fetch('http://localhost:7130/api/auth/oauth/google');
  const { authUrl } = await response.json();
  window.location.href = authUrl;
}

// Handle callback (in your callback page)
async function handleGoogleCallback() {
  // The backend handles the OAuth flow and redirects back with tokens
  const urlParams = new URLSearchParams(window.location.search);
  const token = urlParams.get('token');
  
  if (token) {
    localStorage.setItem('access_token', token);
    // Get user info
    const response = await fetch('http://localhost:7130/api/auth/sessions/current', {
      headers: { 'Authorization': `Bearer ${token}` }
    });
    const { user } = await response.json();
    localStorage.setItem('user_id', user.id);
    
    // Redirect to dashboard
    window.location.href = '/dashboard';
  }
}
```

### React Component

```jsx
function OAuthButtons() {
  const [providers, setProviders] = useState({});

  useEffect(() => {
    fetch('http://localhost:7130/api/config/oauth/status')
      .then(res => res.json())
      .then(setProviders);
  }, []);

  async function loginWithGoogle() {
    const response = await fetch('http://localhost:7130/api/auth/oauth/google');
    const { authUrl } = await response.json();
    window.location.href = authUrl;
  }

  async function loginWithGitHub() {
    const response = await fetch('http://localhost:7130/api/auth/oauth/github');
    const { authUrl } = await response.json();
    window.location.href = authUrl;
  }

  return (
    <div>
      {providers.google?.enabled && (
        <button onClick={loginWithGoogle}>
          Sign in with Google
        </button>
      )}
      {providers.github?.enabled && (
        <button onClick={loginWithGitHub}>
          Sign in with GitHub
        </button>
      )}
    </div>
  );
}
```

## GitHub OAuth

### Get Client ID

1. Go to GitHub Settings > Developer settings > OAuth Apps
2. Click "New OAuth App"
3. Set Authorization callback URL: `http://localhost:7130/api/auth/oauth/github/callback`
4. Copy Client ID and Client Secret

### Implementation

```javascript
// Same pattern as Google
async function loginWithGitHub() {
  const response = await fetch('http://localhost:7130/api/auth/oauth/github');
  const { authUrl } = await response.json();
  window.location.href = authUrl;
}
```

## OAuth Flow

1. User clicks "Sign in with Google/GitHub"
2. Redirect to provider's OAuth page
3. User authorizes your app
4. Provider redirects to InsForge callback
5. InsForge creates/updates user account
6. InsForge redirects to your app with tokens

## Update OAuth Config (Admin)

```bash
curl -X PUT http://localhost:7130/api/config/oauth \
  -H "Authorization: Bearer ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "google": {
      "clientId": "new-google-client-id",
      "clientSecret": "new-google-secret"
    }
  }'
```

## Link OAuth to Existing Account

When user is already logged in:

```javascript
async function linkGoogleAccount() {
  const token = localStorage.getItem('access_token');
  
  // Get OAuth URL with redirect parameter
  const response = await fetch(`http://localhost:7130/api/auth/oauth/google?redirectUrl=/dashboard`);
  const { authUrl } = await response.json();
  window.location.href = authUrl;
}
```

## OAuth User Data

OAuth creates entries in system tables:

- `_user` - User profile (email, name, image)
- `_account` - OAuth provider details (provider, providerAccountId)

```bash
# Get user with OAuth accounts
curl http://localhost:7130/api/auth/sessions/current \
  -H "Authorization: Bearer TOKEN"
```

Response includes OAuth data:
```json
{
  "user": {
    "id": "uuid",
    "email": "user@gmail.com",
    "name": "John Doe",
    "image": "https://googleusercontent.com/photo.jpg",
    "accounts": [
      {
        "provider": "google",
        "providerAccountId": "google-user-id"
      }
    ]
  }
}
```

## Multiple OAuth Providers

Users can link multiple providers to one account:

```javascript
// Check linked providers
async function getLinkedProviders() {
  const response = await fetch('http://localhost:7130/api/auth/sessions/current', {
    headers: { 'Authorization': `Bearer ${token}` }
  });
  
  const { user } = await response.json();
  const providers = user.accounts.map(acc => acc.provider);
  
  return providers; // ['google', 'github']
}
```

## Troubleshooting

### Common Issues

| Issue | Solution |
|-------|----------|
| "Redirect URI mismatch" | Check callback URL matches exactly |
| "Invalid client" | Verify CLIENT_ID and SECRET are correct |
| "OAuth not enabled" | Check environment variables are set |
| "User already exists" | Email already registered with different method |

### Debug OAuth

```bash
# Check OAuth configuration
curl http://localhost:7130/api/config/oauth/status

# Test OAuth redirect
curl http://localhost:7130/api/auth/oauth/google

# Check logs for OAuth errors
docker logs insforge-backend
```

## Security Notes

<Warning>
- Never expose CLIENT_SECRET in frontend code
- Use HTTPS in production for OAuth callbacks
- Validate redirect URIs to prevent open redirects
- Store tokens securely (httpOnly cookies in production)
</Warning>

## Next Steps

<CardGroup cols={2}>
  <Card title="User Management" href="/auth/users">
    Manage user accounts
  </Card>
  <Card title="Sessions" href="/auth/sessions">
    Handle user sessions
  </Card>
</CardGroup>