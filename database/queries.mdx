---
title: Advanced Queries
description: Master complex database queries with PostgREST operators, joins, aggregations, and full-text search
---

# Advanced Queries

Learn how to construct powerful queries using PostgREST's advanced features including complex filters, joins, aggregations, and full-text search.

## Query Syntax Overview

PostgREST uses a unique query syntax:
```
?column=operator.value
```

Multiple conditions are combined with `&` (AND) or `or` (OR).

## Complex Filtering

### Combining Conditions

#### AND Logic
Multiple parameters create AND conditions:

```bash
# Products that are in stock AND priced between 10 and 50
curl "http://localhost:7130/api/database/records/products\
?in_stock=eq.true\
&price=gte.10\
&price=lte.50" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### OR Logic
Use the `or` parameter for OR conditions:

```bash
# Products in electronics OR computers category
curl "http://localhost:7130/api/database/records/products\
?or=(category.eq.electronics,category.eq.computers)" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### Nested Logic
Combine AND and OR for complex queries:

```bash
# In stock AND (electronics OR computers) AND price < 100
curl "http://localhost:7130/api/database/records/products\
?in_stock=eq.true\
&or=(category.eq.electronics,category.eq.computers)\
&price=lt.100" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### Negation

Use `not` to negate any condition:

```bash
# Products NOT in electronics category
curl "http://localhost:7130/api/database/records/products?not.category=eq.electronics" \
  -H "Authorization: Bearer YOUR_TOKEN"

# Products without a discount (discount is NULL)
curl "http://localhost:7130/api/database/records/products?discount=is.null" \
  -H "Authorization: Bearer YOUR_TOKEN"

# Products with any discount (discount is NOT NULL)
curl "http://localhost:7130/api/database/records/products?not.discount=is.null" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## Pattern Matching

### Basic Pattern Matching

```bash
# Contains 'Widget' anywhere (case-sensitive)
curl "http://localhost:7130/api/database/records/products?name=like.*Widget*" \
  -H "Authorization: Bearer YOUR_TOKEN"

# Starts with 'Super' (case-insensitive)
curl "http://localhost:7130/api/database/records/products?name=ilike.Super*" \
  -H "Authorization: Bearer YOUR_TOKEN"

# Ends with 'Pro'
curl "http://localhost:7130/api/database/records/products?name=like.*Pro" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### Pattern Matching Wildcards

| Wildcard | Description | Example |
|----------|-------------|---------|
| `*` | Any characters | `*widget*` matches 'superwidget' |
| `?` | Single character | `?idget` matches 'widget' |

## Working with JSON Data

### Query JSON Fields

```bash
# Query top-level JSON field
curl "http://localhost:7130/api/database/records/products\
?metadata->color=eq.red" \
  -H "Authorization: Bearer YOUR_TOKEN"

# Query nested JSON field
curl "http://localhost:7130/api/database/records/products\
?metadata->dimensions->width=gt.10" \
  -H "Authorization: Bearer YOUR_TOKEN"

# Query JSON array contains
curl "http://localhost:7130/api/database/records/products\
?tags@>['electronics','sale']" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### JSON Operators

| Operator | Description | Example |
|----------|-------------|---------|
| `->` | Get JSON field | `metadata->color` |
| `->>` | Get JSON field as text | `metadata->>color` |
| `@>` | Contains | `tags@>['sale']` |
| `<@` | Contained by | `tags<@['electronics','computers','phones']` |

## Date and Time Queries

### Date Comparisons

```bash
# Records created today
curl "http://localhost:7130/api/database/records/orders\
?created_at=gte.2024-01-15T00:00:00Z\
&created_at=lt.2024-01-16T00:00:00Z" \
  -H "Authorization: Bearer YOUR_TOKEN"

# Records from last 7 days
curl "http://localhost:7130/api/database/records/orders\
?created_at=gte.now()-7days" \
  -H "Authorization: Bearer YOUR_TOKEN"

# Records from this month
curl "http://localhost:7130/api/database/records/orders\
?created_at=gte.2024-01-01\
&created_at=lt.2024-02-01" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## Selecting and Shaping Data

### Column Selection

```bash
# Select specific columns
curl "http://localhost:7130/api/database/records/products\
?select=id,name,price" \
  -H "Authorization: Bearer YOUR_TOKEN"

# Rename columns in response
curl "http://localhost:7130/api/database/records/products\
?select=id,product_name:name,cost:price" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### Computed Fields

```bash
# Cast to different type
curl "http://localhost:7130/api/database/records/products\
?select=id,name,price::text" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## Joins and Relationships

### Foreign Key Joins

If you have foreign key relationships, PostgREST can automatically join tables:

```bash
# Get orders with user information
curl "http://localhost:7130/api/database/records/orders\
?select=id,total,user:user_id(id,email,name)" \
  -H "Authorization: Bearer YOUR_TOKEN"

# Get products with category details
curl "http://localhost:7130/api/database/records/products\
?select=id,name,price,category:category_id(id,name,description)" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### Filtering Joined Data

```bash
# Get orders where user email contains 'gmail'
curl "http://localhost:7130/api/database/records/orders\
?select=id,total,user:user_id(email)\
&user.email=like.*gmail*" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## Sorting and Ordering

### Basic Sorting

```bash
# Sort by single column
curl "http://localhost:7130/api/database/records/products?order=price.asc" \
  -H "Authorization: Bearer YOUR_TOKEN"

# Sort by multiple columns
curl "http://localhost:7130/api/database/records/products\
?order=category.asc,price.desc" \
  -H "Authorization: Bearer YOUR_TOKEN"

# Sort with nulls first/last
curl "http://localhost:7130/api/database/records/products\
?order=discount.desc.nullslast" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## Pagination Strategies

### Offset Pagination

```bash
# Page 1 (records 0-9)
curl "http://localhost:7130/api/database/records/products" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Range: 0-9" \
  -H "Prefer: count=exact"

# Page 2 (records 10-19)
curl "http://localhost:7130/api/database/records/products" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Range: 10-19" \
  -H "Prefer: count=exact"
```

### Limit and Offset

```bash
# Alternative pagination syntax
curl "http://localhost:7130/api/database/records/products\
?limit=10&offset=20" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### Cursor Pagination

For better performance with large datasets:

```bash
# Get next page after specific ID
curl "http://localhost:7130/api/database/records/products\
?id=gt.last-seen-id\
&order=id.asc\
&limit=10" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## Full-Text Search

If you have full-text search columns configured:

```bash
# Full-text search
curl "http://localhost:7130/api/database/records/products\
?description=fts.wireless+headphones" \
  -H "Authorization: Bearer YOUR_TOKEN"

# With language specification
curl "http://localhost:7130/api/database/records/products\
?description=fts(english).wireless+headphones" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## Query Examples

### E-commerce Product Search

```typescript
// Advanced product search with filters
async function searchProducts(filters: {
  search?: string;
  minPrice?: number;
  maxPrice?: number;
  categories?: string[];
  inStock?: boolean;
  sortBy?: 'price' | 'name' | 'created_at';
  page?: number;
}) {
  const params = new URLSearchParams();
  
  // Text search
  if (filters.search) {
    params.append('name', `ilike.*${filters.search}*`);
  }
  
  // Price range
  if (filters.minPrice !== undefined) {
    params.append('price', `gte.${filters.minPrice}`);
  }
  if (filters.maxPrice !== undefined) {
    params.append('price', `lte.${filters.maxPrice}`);
  }
  
  // Categories (OR condition)
  if (filters.categories?.length) {
    const categoryFilter = filters.categories
      .map(cat => `category.eq.${cat}`)
      .join(',');
    params.append('or', `(${categoryFilter})`);
  }
  
  // Stock status
  if (filters.inStock !== undefined) {
    params.append('in_stock', `eq.${filters.inStock}`);
  }
  
  // Sorting
  const sortColumn = filters.sortBy || 'created_at';
  params.append('order', `${sortColumn}.desc`);
  
  // Pagination
  const page = filters.page || 1;
  const limit = 20;
  const offset = (page - 1) * limit;
  
  const response = await fetch(
    `/api/database/records/products?${params}`,
    {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Range': `${offset}-${offset + limit - 1}`,
        'Prefer': 'count=exact'
      }
    }
  );
  
  const data = await response.json();
  const contentRange = response.headers.get('Content-Range');
  const total = contentRange ? parseInt(contentRange.split('/')[1]) : 0;
  
  return {
    products: data,
    pagination: {
      page,
      totalPages: Math.ceil(total / limit),
      total
    }
  };
}
```

### User Activity Dashboard

```typescript
// Get user activity with aggregated data
async function getUserActivity(userId: string, days: number = 7) {
  const startDate = new Date();
  startDate.setDate(startDate.getDate() - days);
  
  // Get user's recent orders
  const orders = await fetch(
    `/api/database/records/orders?` +
    `user_id=eq.${userId}&` +
    `created_at=gte.${startDate.toISOString()}&` +
    `select=id,total,status,created_at&` +
    `order=created_at.desc`,
    {
      headers: { 'Authorization': `Bearer ${token}` }
    }
  ).then(r => r.json());
  
  // Get user's comments
  const comments = await fetch(
    `/api/database/records/comments?` +
    `user_id=eq.${userId}&` +
    `created_at=gte.${startDate.toISOString()}&` +
    `select=id,content,post_id,created_at&` +
    `order=created_at.desc&` +
    `limit=10`,
    {
      headers: { 'Authorization': `Bearer ${token}` }
    }
  ).then(r => r.json());
  
  return {
    orders,
    comments,
    period: `${days} days`
  };
}
```

## Performance Best Practices

1. **Use Indexes**: Create indexes on frequently queried columns
2. **Limit Columns**: Only select needed columns with `?select=`
3. **Use Pagination**: Always paginate large result sets
4. **Optimize OR Queries**: OR conditions can be slow; consider restructuring
5. **Cache Results**: Implement client-side caching for frequently accessed data
6. **Use Appropriate Operators**: `eq` is faster than `like`

## Troubleshooting

### Common Issues

1. **Empty Results**: Check your filters aren't too restrictive
2. **Slow Queries**: Add indexes, limit results, or simplify conditions
3. **Invalid Column**: Verify column exists and isn't in a joined table
4. **Pattern Matching**: Remember `*` not `%` for wildcards

### Debug Tips

```bash
# Check what SQL is being generated (if you have access to logs)
curl "http://localhost:7130/api/database/records/products?name=like.*test*" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Prefer: params=single-object" \
  -v
```

## Next Steps

<CardGroup cols={2}>
  <Card title="Migrations" href="/database/migrations">
    Learn about database migrations
  </Card>
  <Card title="API Reference" href="/api-reference/records/get-records">
    Explore the complete API
  </Card>
</CardGroup>