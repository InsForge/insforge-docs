---
title: Database API
description: REST API reference for database operations
---

# Database API

<Warning>
**Critical**: POST requests require array syntax `[{...}]` even for single records. This is PostgREST behavior, not traditional REST.
</Warning>

## Base URL

```
http://localhost:7130/api/database/records/{table_name}
```

## CRUD Operations

### Create (POST)

```bash
# Single record (array required!)
curl -X POST http://localhost:7130/api/database/records/products \
  -H 'Authorization: Bearer TOKEN' \
  -H 'Content-Type: application/json' \
  -H 'Prefer: return=representation' \
  -d '[{"name": "Widget", "price": 19.99}]'

# Multiple records
curl -X POST http://localhost:7130/api/database/records/products \
  -H 'Authorization: Bearer TOKEN' \
  -H 'Content-Type: application/json' \
  -H 'Prefer: return=representation' \
  -d '[{"name": "Widget", "price": 19.99}, {"name": "Gadget", "price": 29.99}]'
```

### Read (GET)

```bash
# All records
curl http://localhost:7130/api/database/records/products \
  -H 'Authorization: Bearer TOKEN'

# Select columns
curl 'http://localhost:7130/api/database/records/products?select=id,name,price' \
  -H 'Authorization: Bearer TOKEN'

# Filter
curl 'http://localhost:7130/api/database/records/products?price=gte.20' \
  -H 'Authorization: Bearer TOKEN'
```

### Update (PATCH)

```bash
# Update by ID
curl -X PATCH 'http://localhost:7130/api/database/records/products?id=eq.123' \
  -H 'Authorization: Bearer TOKEN' \
  -H 'Content-Type: application/json' \
  -H 'Prefer: return=representation' \
  -d '{"price": 24.99}'

# Update multiple
curl -X PATCH 'http://localhost:7130/api/database/records/products?in_stock=eq.false' \
  -H 'Authorization: Bearer TOKEN' \
  -H 'Content-Type: application/json' \
  -d '{"in_stock": true}'
```

### Delete (DELETE)

```bash
# Delete by ID
curl -X DELETE 'http://localhost:7130/api/database/records/products?id=eq.123' \
  -H 'Authorization: Bearer TOKEN' \
  -H 'Prefer: return=representation'

# Delete multiple
curl -X DELETE 'http://localhost:7130/api/database/records/products?price=lt.10' \
  -H 'Authorization: Bearer TOKEN'
```

## Response Behavior

### Without `Prefer: return=representation`

| Operation | Response |
|-----------|----------|
| POST | `[]` (empty array) |
| PATCH | 204 No Content |
| DELETE | 204 No Content |

### With `Prefer: return=representation`

| Operation | Response |
|-----------|----------|
| POST | Array of created records |
| PATCH | Array of updated records |
| DELETE | Array of deleted records |

<Note>
DELETE is idempotent - it returns success even if the record doesn't exist. With `Prefer: return=representation`, it returns `[]` if no records were deleted.
</Note>

## Query Operators

| Operator | Description | Example |
|----------|-------------|---------|
| `eq` | Equals | `?price=eq.19.99` |
| `neq` | Not equal | `?status=neq.deleted` |
| `gt` | Greater than | `?price=gt.20` |
| `gte` | Greater or equal | `?price=gte.20` |
| `lt` | Less than | `?price=lt.50` |
| `lte` | Less or equal | `?price=lte.50` |
| `like` | Pattern match | `?name=like.*Widget*` |
| `ilike` | Case-insensitive | `?name=ilike.*widget*` |
| `in` | In list | `?id=in.(1,2,3)` |
| `is` | NULL check | `?deleted_at=is.null` |
| `not` | Negate | `?not.price=gt.100` |

## Common Patterns

### Pagination

```bash
curl http://localhost:7130/api/database/records/products \
  -H 'Authorization: Bearer TOKEN' \
  -H 'Range: 0-9' \
  -H 'Prefer: count=exact'

# Response: Content-Range: 0-9/100
```

### Sorting

```bash
# Single column
curl 'http://localhost:7130/api/database/records/products?order=price.desc' \
  -H 'Authorization: Bearer TOKEN'

# Multiple columns
curl 'http://localhost:7130/api/database/records/products?order=category.asc,price.desc' \
  -H 'Authorization: Bearer TOKEN'
```

### Complex Queries

```bash
# AND (multiple params)
curl 'http://localhost:7130/api/database/records/products?price=gte.20&in_stock=eq.true' \
  -H 'Authorization: Bearer TOKEN'

# OR
curl 'http://localhost:7130/api/database/records/products?or=(price.lt.10,price.gt.100)' \
  -H 'Authorization: Bearer TOKEN'

# JSON fields
curl 'http://localhost:7130/api/database/records/products?metadata->color=eq.red' \
  -H 'Authorization: Bearer TOKEN'
```

## JavaScript Example

```javascript
// IMPORTANT: POST requires array syntax even for single records!
async function createProduct(token, product) {
  const response = await fetch('/api/database/records/products', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json',
      'Prefer': 'return=representation'
    },
    body: JSON.stringify([product]) // Array required!
  });
  
  return response.json();
}

// Query with filters
async function getProducts(token) {
  const response = await fetch('/api/database/records/products?price=gte.20&in_stock=eq.true', {
    headers: { 'Authorization': `Bearer ${token}` }
  });
  
  return response.json();
}

// Pagination with count
async function getProductsPage(token, page = 1, limit = 10) {
  const offset = (page - 1) * limit;
  const response = await fetch('/api/database/records/products', {
    headers: {
      'Authorization': `Bearer ${token}`,
      'Range': `${offset}-${offset + limit - 1}`,
      'Prefer': 'count=exact'
    }
  });
  
  const data = await response.json();
  const contentRange = response.headers.get('Content-Range');
  const total = contentRange ? parseInt(contentRange.split('/')[1]) : 0;
  
  return { data, total, page, totalPages: Math.ceil(total / limit) };
}
```

## Error Handling

```javascript
// PostgREST error format
{
  "error": "PGRST116",
  "message": "column products.invalid_column does not exist",
  "statusCode": 400
}

// Handle errors properly
if (!response.ok) {
  const error = await response.json();
  // Show user-friendly message, not raw error
  alert('Unable to save product. Please try again.');
}
```

## Tips

- **Always use array syntax** for POST: `[{...}]`
- **Add `Prefer: return=representation`** to see created/updated data
- **Use `?select=`** to fetch only needed columns
- **Implement pagination** for large datasets with Range headers
- **Use `eq` over `like`** when exact matching for better performance

## Next Steps

<CardGroup cols={2}>
  <Card title="Advanced Queries" href="/database/queries">
    Master complex query patterns
  </Card>
  <Card title="Row Level Security" href="/database/migrations">
    Implement fine-grained access control
  </Card>
</CardGroup>