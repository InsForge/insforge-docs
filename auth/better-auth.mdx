---
title: Implementing Authentication
description: Adding authentication to your application
---

# Implementing Authentication

## Basic Implementation

```javascript
// Simple auth implementation
class Auth {
  async register(email, password, name) {
    const response = await fetch('/api/auth/users', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password, name })
    });
    
    const { accessToken, user } = await response.json();
    localStorage.setItem('access_token', accessToken);
    localStorage.setItem('user_id', user.id);
    return user;
  }

  async login(email, password) {
    const response = await fetch('/api/auth/sessions', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    
    const { accessToken, user } = await response.json();
    localStorage.setItem('access_token', accessToken);
    localStorage.setItem('user_id', user.id);
    return user;
  }

  async getCurrentUser() {
    const token = localStorage.getItem('access_token');
    const response = await fetch('/api/auth/sessions/current', {
      headers: { 'Authorization': `Bearer ${token}` }
    });
    
    const { user } = await response.json(); // Note: nested structure
    return user;
  }

  logout() {
    localStorage.removeItem('access_token');
    localStorage.removeItem('user_id');
    window.location.href = '/login';
  }
}

const auth = new Auth();
```

## Protected API Calls

```javascript
// Always include the access token
async function createPost(content) {
  const token = localStorage.getItem('access_token');
  const userId = localStorage.getItem('user_id');
  
  return fetch('/api/database/records/posts', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json',
      'Prefer': 'return=representation'
    },
    body: JSON.stringify([{ user_id: userId, content }])
  });
}
```

<Note>
Remember: Database POST requests require array syntax `[{...}]` even for single records.
</Note>

## React Example

```jsx
// Simple React auth hook
function useAuth() {
  const [user, setUser] = useState(null);
  
  useEffect(() => {
    // Check if user is logged in
    const token = localStorage.getItem('access_token');
    if (token) {
      fetch('/api/auth/sessions/current', {
        headers: { 'Authorization': `Bearer ${token}` }
      })
      .then(res => res.json())
      .then(data => setUser(data.user));
    }
  }, []);
  
  const login = async (email, password) => {
    const res = await fetch('/api/auth/sessions', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    
    const { accessToken, user } = await res.json();
    localStorage.setItem('access_token', accessToken);
    localStorage.setItem('user_id', user.id);
    setUser(user);
    return user;
  };
  
  const logout = () => {
    localStorage.removeItem('access_token');
    localStorage.removeItem('user_id');
    setUser(null);
  };
  
  return { user, login, logout };
}
```

## Error Handling

```javascript
// Handle auth errors gracefully
async function handleLogin(email, password) {
  try {
    const response = await fetch('/api/auth/sessions', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    
    if (!response.ok) {
      const error = await response.json();
      
      // Show user-friendly message
      if (error.error === 'AUTH_INVALID_CREDENTIALS') {
        alert('Invalid email or password');
      } else {
        alert('Login failed. Please try again.');
      }
      return;
    }
    
    const { accessToken, user } = await response.json();
    // Store and redirect...
  } catch (err) {
    alert('Network error. Please check your connection.');
  }
}
```

## Important Notes

- JWT access tokens expire after 7 days
- The `_user` table is read-only via database API
- Always check `/api/auth/sessions/current` returns `{user: {...}}` (nested)
- Store both `access_token` and `user_id` in localStorage

## Next Steps

<CardGroup cols={2}>
  <Card title="OAuth Providers" href="/auth/oauth-providers">
    Add Google and GitHub login
  </Card>
  <Card title="User Management" href="/auth/users">
    Manage users and profiles
  </Card>
</CardGroup>